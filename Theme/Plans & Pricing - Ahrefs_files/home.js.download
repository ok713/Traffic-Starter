"use strict";
//Tools
var toolsButtons = $('#toolsButtons').find('li'),
    toolsContents = $('#toolsContents').find('li'),
    PreloadImages = {},
    SliderBigImageObj = $("#slider_big_image"),
    slideImageWrapper = $('#slideImage');


toolsButtons.each(function (i) {
    PreloadImages[this.id] = new Image();
    PreloadImages[this.id].src = $(this).data("image");
});
function showTools(index){
    var imgSrc = SliderBigImageObj.attr('src');
    // var index = $(item).index();
    if (typeof(PreloadImages[toolsButtons.eq(index).attr('id')].src) != 'undefined' && PreloadImages[toolsButtons.eq(index).attr('id')].src != null)
    {
        var img = '<img src="'+imgSrc+'" width="787" height="528" alt="Ahrefs" style="z-index: 9;" id="slider_image_fade">';
        slideImageWrapper.prepend(img);
        $('#slider_image_fade').stop().fadeOut(800, function () {
            $('#slider_image_fade').remove();
        });
        SliderBigImageObj.attr("src", PreloadImages[toolsButtons.eq(index).attr('id')].src);
    }
    toolsButtons.removeClass('active');
    toolsButtons.eq(index).addClass('active');
    toolsContents.removeClass('active');
    toolsContents.eq(index).addClass('active');
    return false;
}
toolsButtons.click(function(e){
    e.preventDefault();
    stopAnimateTools(); // Stop ALL animations on the tools contents.
    var index = $(this).index();
    showTools(index);
});

/* Animate the tools
 ******************************
 */
var animateTime = 3000; // 3 second
var animateTools;
var animateIndex = 0;
var startAnimateTools = function () {
    animateTools = setTimeout(function(){
        // toolsButtons.eq(animateIndex).trigger('click');
        stopAnimateTools(); // Stop ALL animations on the tools contents.
        showTools(animateIndex);
        if(animateIndex == toolsButtons.length -1){
            animateIndex = 0;
        }  else {
            animateIndex++;
        }

        startAnimateTools();
    }, animateTime)
};

function stopAnimateTools(){
    clearTimeout(animateTools);
}

(slideImageWrapper.length > 0 ) ? startAnimateTools() : "";

/* Click outside to clear intercom
 **********************************
 */

/*
 $('body .content, header, footer').click(function (e) {
 if ($(e.target).closest("#toolsButtons li").length === 0) {
 Intercom('hide');
 }
 });
 */

$('.count').each(function () {
    $(this).prop('Counter',0).animate({
        Counter: $(this).text()
    }, {
        duration: 2000,
        easing: 'swing',
        step: function (now) {
            $(this).text(Math.ceil(now));
        },
        complete: function(){
            // console.log();
            $('.home__datas__item--cpu').find('.count').text(parseInt($('.home__datas__item--cpu').find('.count').text()).toLocaleString());
        }
    });
});
/* Sign In
 *********************/
/* Sign In
 *********************/
var loginBtn = $('#signIn'),
    tryAhrefsBtn = $('.tryAhrefsFree'),
    signInModal = $('#signInModal'),
    signInModalClose = $('#closeSignIn');

var showSignInModal = function(){
    signInModal.fadeIn(100);
};
var hideSignInModal = function(){
    signInModal.fadeOut(100);
};

tryAhrefsBtn.on('click', function(e){
    e.preventDefault();
    showTryAhrefsModal();
});

loginBtn.on('click', function(e){
    e.preventDefault();
    showSignInModal();
    $('#emailLogin').focus();
});

signInModalClose.on('click',hideSignInModal);

$('.a-dropdown').click(function () {
    var self = $(this).find('p.current');
    var next = $(this).find('p.current').next();
    if(next.css('display') == "none") {
        next.css('display', 'block');
    }
    else {
        next.css('display', 'none');
    }
});

/* CANVAS BACKGROUND FOR HOME PAGE TOOLS
 ****************************************
 */

function draw(){
    for(var i = 0; i < 40; i++){
        var randomPX= Math.floor((Math.random() * 1800) + 1);
        var randomPY= Math.floor((Math.random() * 1000) + 1);
        var randomSize= Math.floor((Math.random() * 20) + 5);

        ctx.fillStyle = "#0f4c7b";
        ctx.fillRect(randomPX,randomPY,randomSize,randomSize);
    }
}

if($('#dataCanvas').length > 0 ){
    var c = document.getElementById('dataCanvas');
    var ctx = c.getContext('2d');
    draw();
}

/* PRICING PLAN
 **/
/*
function changeTab (_current, _next){
    var index =_current.index();
    var content = _next.find('>li');

    _current.addClass('active');
    content.removeClass('active');
    content.eq(index).addClass('active');
}

if($('#pricingTab').length > 0){
    var tab_t = $('#pricingTab').find('li');
    tab_t.on('click', function () {
        var self = $(this);
        var next = $('#pricingTab').next('.tab-content');
        tab_t.removeClass('active');
        changeTab(self, $('#pricingContent'));
        changeTab(self, $('#pricingContentAgency'));
    })
}

if($('#pricingDetailTab').length > 0){
    var tab_p = $('#pricingDetailTab').find('li');
    tab_p.on('click', function () {
        var self = $(this);
        tab_p.removeClass('active');

        changeTab(self, $('#pricingDetailContent'));

        if ($('#monthlyButtons').is(":visible")) {
            $('#monthlyButtons').hide();
            $('#annualButtons').show();
        }
        else {
            $('#annualButtons').hide();
            $('#monthlyButtons').show();
        }
    })
}

if($('#detailPricingBtn').length > 0){
    var pricingDBtn = $('#detailPricingBtn'), pricingplanModalCover = $('#pricingplanModalCover'), pricingDBtnModal = $('#pricingplanModal'), pricingDBtnModalClose = $('#closePricingplan');
    var showpricingDModal = function(){
        pricingDBtnModal.fadeIn(100);
        pricingplanModalCover.fadeIn(100);
    };
    var hidepricingDModal = function(){
        pricingDBtnModal.fadeOut(100);
        pricingplanModalCover.fadeOut(100)
    };
    pricingDBtn.on('click', function(e){
        e.preventDefault();
        showpricingDModal();
        $('#emailLogin').focus();
    });
    pricingDBtnModalClose.on('click',hidepricingDModal);
}
*/

if($('[data-toggle="tooltip"]').length > 0){
    $('[data-toggle="tooltip"]').tooltip({html:true});
}

/* == Footer language */

$('#lang-home').click(function(){
    if($(this).find('.langs').is(":visible")){
        $(this).find('.langs').hide();
    } else {
        $(this).find('.langs').show();
    }
});

if(typeof Tipped != "undefined"){
    Tipped.remove($('.ahrefs-icon-info'));
    $('.ahrefs-icon-info').each(function () {
        Tipped.create($(this), $("#"+$(this).data('tip')).html(), {position: $(this).data('position'), size: 'medium', maxWidth: 247});
    });
}